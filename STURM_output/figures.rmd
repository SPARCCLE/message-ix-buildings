---
output: reprex::reprex_document
knit: reprex::reprex_render
---

Notebook to run STURM Ouput.

```{r}
library(dplyr)
library(ggplot2)
library(stringr)

print(paste("Working directory is:", getwd()))

# Loding figures setttings and functions
source("STURM_output/plot_settings.R")

```

```{r}
file <- "report_STURM_EU_implementation_resid_region_bld_energy.csv"
file <- paste("STURM_output", file, sep = "/")

if (!file.exists(file)) {
  print("Check file name or directory!")
}

save_dir <- paste("STURM_output", "figures", sep = "/")
print(dir.exists(save_dir))
```

```{r}
# Read output files
data <- read.csv(file)
print(summary(data))
```

## Data formatting
```{r}
data <- data %>%
    mutate(heat_TWh = heat_TJ / 3.6 / 1e3) %>%
    mutate(heat_ktoe = heat_TWh * 85.980) %>%
    mutate(heat_hh_kWh = heat_TWh * 1e3 / stock_M) %>%
    mutate()

data <- data %>%
  mutate("efficiency" = ifelse(eneff == "avg" | bld_age == "p5",
    bld_age, eneff))
```

## Figures

```{r}
source("STURM_output/plot_settings.R")
```

### Buidling stock evolution by space heating fuels
```{r}
plot_stacked_area(data, "year", "stock_M", "fuel_heat",
                  y_label = "Stock households\nMillion buildings",
                  save_path = paste(save_dir, "stock_hh_fuel.png", sep = "/"))
```

### Buidling stock evolution by country
```{r}
plot_stacked_area(data, "year", "stock_M", "efficiency",
                  y_label = "Stock households\nMillion buildings",
                  save_path = paste(save_dir, "stock_hh_countries.png", sep = "/"))
```

## Final energy consumption for space heating in the Residential sector (TWh)
```{r}
plot_stacked_area(data, "year", "heat_ktoe", "fuel_heat",
                  y_label = "Final energy consumption for space heating\nResidential sector\nktoe",
                  save_path = paste(save_dir, "heating_fuel.png", sep = "/")
                  )
```

```{r}
plot_variable_evolution(data,
                        x_column = "year",
                        y_column = "heat_TWh",
                        group_column = "region_bld",
                        subplot = TRUE,
                        save_path = paste(save_dir, "heat_evolution.png", sep="/"))
```




