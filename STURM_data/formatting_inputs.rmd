---
output: reprex::reprex_document
knit: reprex::reprex_render
---

Notebook to run STURM Ouput.

```{r}
library(tidyverse)

print(paste("Working directory is:", getwd()))

```

### Heating Degree Days
```{r}
folder <- "STURM_data/input_csv/input_resid/climate"
countries <- read.csv(file.path(folder, "mapping_countries.csv"))
data <- read.csv(file.path(folder,
  "ISO_agg_data_SDD_H_v2023_08_ssp2_2010_hist_czones.csv"))

countries <- countries %>%
  left_join(data, by = c("ISO")) %>%
  select(c("region_bld", "CLIMATE_ZONE", "sdd_h_avg")) %>%
  rename(clim = CLIMATE_ZONE, value = sdd_h_avg)

write.csv(countries,
  file.path(folder, "hdd_eu.csv"),
  row.names = FALSE)

```
### Energy prices from MESSAGE
```{r}

folder <- "STURM_data/input_csv/input_resid/macro"
paths <- c("price_en_message_engage_NPi.csv" = "input_prices_NPi.csv",
  "price_en_message_engage_NPi2020_600.csv" = "input_prices_NPi2020_600.csv")


for (path in names(paths)){
  print(path)
  data <- read.csv(file.path(folder, path))

  # Reshape the data to long format and extract the year from column names
  data_long <- data %>%
    pivot_longer(cols = starts_with("y"),
      names_to = "year", values_to = "value") %>%
    mutate(year = as.integer(stringr::str_extract(year, "\\d{4}"))) %>%
    filter(ssp == "SSP2") %>%
    select(-ssp)

  write.csv(data_long,
    file.path(folder, paths[path]),
    row.names = FALSE)
  }

```